#include <amxmodx>

#define OWNER ADMIN_MENU
#define COOWNER ADMIN_LEVEL_H
#define ADMINISTRATOR ADMIN_LEVEL_B
#define COADMINISTRATOR ADMIN_LEVEL_A
#define MINI-ADMIN ADMIN_KICK

static const COLOR[] = "^x04"
static const CONTACT[] = "www.infectati.besaba.com"

new maxplayers
new gmsgSayText

public plugin_init() {
	register_plugin("Admin Check", "1.51", "OneEyed")
	maxplayers = get_maxplayers()
	gmsgSayText = get_user_msgid("SayText")
	register_clcmd("say", "handle_say")
	register_cvar("amx_contactinfo", CONTACT, FCVAR_SERVER)
}

public handle_say(id) {
	new said[192]
	read_args(said,192)
	if( ( containi(said, "/who") != -1 && containi(said, "admin") != -1 ) || contain(said, "/admin") != -1 )
		set_task(0.1,"print_adminlist",id)
	return PLUGIN_CONTINUE
}

public print_adminlist(user) 
{
	new adminowner[33][32]
	new admincoowner[33][32]
	new adminadministrator[33][32]
	new admincoadministrator[33][32]
	new adminminiadmin[33][32]
	new message[256]
	new contactinfo[256], contact[112]
	new id, count, x, len
	
	for(id = 1 ; id <= maxplayers ; id++)
		if(is_user_connected(id))
		{
			if(get_user_flags(id) & OWNER)
				get_user_name(id, adminowner[count++], 31)
			if(get_user_flags(id) & COOWNER)
				get_user_name(id, admincoowner[count++], 31)
			if(get_user_flags(id) & ADMINISTRATOR)
				get_user_name(id, adminadministrator[count++], 31)
			if(get_user_flags(id) & COADMINISTRATOR)
				get_user_name(id, admincoadministrator[count++], 31)
			if(get_user_flags(id) & MINI-ADMIN)
				get_user_name(id, adminminiadmin[count++], 31)
		}

	len = format(message, 255, "%s Admini ONLINE: ",COLOR)
	if(count > 0) {
		for(x = 0 ; x < count ; x++) {
			len += format(message[len], 255-len, "%s%s ", adminowner[x], x < (count-1) ? ", ":"")
			if(len > 96 ) {
				print_message(user, message)
				len = format(message, 255, "%s ",COLOR)
			}
		}
		print_message(user, message)
	}
	else {
		len += format(message[len], 255-len, "Nici un admin ONLINE.")
		print_message(user, message)
	}
	
	get_cvar_string("amx_contactinfo", contact, 63)
	if(contact[0])  {
		format(contactinfo, 111, "%s Forum --- %s", COLOR, contact)
		print_message(user, contactinfo)
	}
}

print_message(id, msg[]) {
	message_begin(MSG_ONE, gmsgSayText, {0,0,0}, id)
	write_byte(id)
	write_string(msg)
	message_end()
}